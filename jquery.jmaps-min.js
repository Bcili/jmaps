/* jQuery Maps (jmaps) - A jQuery plugin for Google Maps API
 * Author: Tane Piper (digitalspaghetti at gmail dot com) 
 * With special thanks Dave Cardwell (who helped on getting the first version of this plugin to work).
 * Website: http://code.google.com/p/jmaps/
 * Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
 * This plugin is not affiliated with Google or Yahoo.  
 * For Google Maps API and T&C see http://www.google.com/apis/maps/
 * For Yahoo! Maps API and T&C see http://developer.yahoo.com/maps/
 * 
 * For support, I can usually be found on the #jquery IRC channel on irc.freenode.net
 */
(function(N){N.fn.extend({jmap:function(u){var D="1.3.1";var u=jQuery.extend({provider:"google",maptype:"hybrid",center:[55.958858,-3.162302],zoom:12,controlsize:"small",showtype:true,showzoom:true,showpan:true,showoverview:true,showscale:true,dragging:true,scrollzoom:false,smoothzoom:true,clickmarker:true},u);return this.each(function(){switch(u.provider){case "yahoo":var i=this.jMap=new YMap(this);switch(u.maptype){case "map":var C=YAHOO_MAP_REG;break;case "sat":var C=YAHOO_MAP_SAT;break;default:var C=YAHOO_MAP_HYB;break;}i.setMapType(C);i.drawZoomAndCenter(new YGeoPoint(u.center[0],u.center[1]),u.zoom);if(u.showtype==true){i.addTypeControl();}if(u.showzoom==true&&u.controlsize=="small"){i.addZoomShort();}if(u.showzoom==true&&u.controlsize=="large"){i.addZoomLong();}if(u.showpan==true){i.addPanControl();}if(u.showscale==false){i.removeZoomScale();}if(u.dragging==false){i.disableDragMap();}if(u.scrollzoom==false){i.disableKeyControls();}if(u.clickmarker==true){YEvent.Capture(i,EventsList.MouseClick,function(K,B){if(K){}else{var K=new YGeoPoint(B.Lat,B.Lon);i.addMarker(K);}});}break;default:var i=this.jMap=new GMap2(this);switch(u.maptype){case "map":var C=G_NORMAL_MAP;break;case "sat":var C=G_SATELLITE_MAP;break;default:var C=G_HYBRID_MAP;break;}i.setCenter(new GLatLng(u.center[0],u.center[1]),u.zoom,C);switch(u.controlsize){case "small":i.addControl(new GSmallMapControl());break;case "large":i.addControl(new GLargeMapControl());break;case "none":break;default:i.addControl(new GSmallMapControl());}if(u.showtype==true){i.addControl(new GMapTypeControl());}if(u.showoverview==true){i.addControl(new GOverviewMapControl());}if(u.scrollzoom==true){i.enableScrollWheelZoom();}if(u.smoothzoom==true){i.enableContinuousZoom();}if(u.dragging==false){i.disableDragging();}if(u.clickmarker==true){GEvent.addListener(i,"dblclick",function(K,B){if(K){i.removeOverlay(K);}else{var K=new GMarker(B);i.addOverlay(K);GEvent.addListener(K,"click",function(){pointlocation=K.getPoint();K.openInfoWindowHtml("Latitude: "+pointlocation.lat()+"<br />Longitude: "+pointlocation.lng());});}});}}if(i.b.jMap){jQuery(document).unload(function(){GUnload();});}});},myMap:function(){return this[0].jMap;},addPoint:function(x,u,K,D,B,i){var p=this[0].jMap;if(p._mapType){var C=new YMarker(new YGeoPoint(x,u));YEvent.Capture(C,EventsList.MouseClick,function(){C.openSmartWindow(D);});if(i==true){YEvent.Capture(C,EventsList.MouseDoubleClick,function(f){p.removeOverlay(f);});}p.addOverlay(C);}else{if(p.b.jMap){var C=new GMarker(new GLatLng(x,u),K,{draggable:B});GEvent.addListener(C,"click",function(){C.openInfoWindowHtml(D);});if(i==true){GEvent.addListener(C,"dblclick",function(){return p.removeOverlay(C);});}return p.addOverlay(C);}}},addPoly:function(u,i,D,C){var B=this[0].jMap;if(B._mapType){return B.addOverlay(u,i,D,C);}else{if(B.b.jMap){return B.addOverlay(u);}}},addRss:function(D,i){var C=this[0].jMap;if(C._mapType){var u=new YGeoRSS(D);YEvent.Capture(C,EventsList.onEndGeoRSS,i);return C.addOverlay(u);}else{if(C.b.jMap){var u=new GGeoXml(D,i);return C.addOverlay(u);}}},searchAddress:function(D,u,i){var u=jQuery.extend({returntype:"map"},u);var C=this[0].jMap;if(C._mapType){C.geoCodeAddress(D);YEvent.Capture(C,EventsList.onEndGeoCode,function(x){if(x.success==0){alert(D+" not found");}else{switch(u.returntype){case "object":var K=[];K[0]=x.GeoPoint.Lat;K[1]=x.GeoPoint.Lon;return i(K);break;default:point=new YGeoPoint(x.GeoPoint.Lat,x.GeoPoint.Lon);C.drawZoomAndCenter(point);var B=new YMarker(point);B.openSmartWindow("Latitude: "+point.Lat+"<br />Longitude: "+point.Lon);C.addOverlay(B);break;}}});}else{if(C.b.jMap){GGeocoder=new GClientGeocoder();GGeocoder.getLatLng(D,function(B){if(!B){alert(D+" not found");}else{switch(u.returntype){case "object":var x=[];x[0]=B.y;x[1]=B.x;return i(x);break;default:C.setCenter(B);var K=new GMarker(B,{draggable:true});C.addOverlay(K);var p=K.getPoint();K.openInfoWindowHtml("Latitude: "+p.lat()+"<br />Longitude: "+p.lng());GEvent.addListener(K,"dragend",function(f){K.openInfoWindowHtml("Latitude: "+f.lat()+"<br />Longitude: "+f.lng());});break;}}});}else{alert("Map Object Not Found!");}}},searchDirections:function(B,i,D){var C=this[0].jMap;if(C._mapType){alert("Yahoo Maps Do Not Support Directions");}else{if(C.b.jMap){var u=document.getElementById(D);search=new GDirections(C,u);search.load("from:"+B+" to:"+i);}}},mapAds:function(u,i){var C=this[0].jMap;var i=jQuery.extend({maxAdsOnMap:3,channel:"",minZoomLevel:6},i);if(C._mapType){alert("Yahoo Maps Do Not Support Map Ads");}else{if(C.b.jMap){var D=new GAdsManager(C,u,i);D.enable();}}},showTraffic:function(){var D=this[0].jMap;D.addOverlay(new GTrafficOverlay());}});})(jQuery);